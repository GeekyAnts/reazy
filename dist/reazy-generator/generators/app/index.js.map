{"version":3,"sources":["../../../../src/reazy-generator/generators/app/index.js"],"names":["generators","require","path","assign","getPolyfill","ora","Shell","fs","ejs","checkCommmand","command","cb","exec","silent","code","stdout","stderr","emptyFolder","folder","rm","mkdir","module","exports","Base","extend","constructor","apply","arguments","initializing","pkg","readJSON","destinationPath","props","name","process","cwd","split","sep","pop","description","dependencies","findReactNativeCli","done","async","spinner","start","isInstalled","fail","exit","match","succeed","checkAndroid","findGit","prompting","prompts","message","default","validate","input","when","prompt","then","bind","writing","application","copySync","templatePath","template","readFileSync","encoding","content","render","outputFileSync","config","join","__dirname","install","devDependencies","self","spinnerInstallDev","npmInstall","saveDev","stdio","spinnerInstall","save","spawnCommandSync","end","log"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nvar generators = require('yeoman-generator');\nvar path = require('path');\nvar assign = require('object.assign').getPolyfill();\nvar ora = require('ora');\nvar Shell = require('shelljs');\nvar fs = require('fs-extra');\nvar ejs = require('ejs');\n\nconst checkCommmand = (command, cb) => {\n  // !!Shell.which(command);\n  Shell.exec('which ' + command, {silent: true}, (code, stdout, stderr) => {\n    cb(!!stdout);\n  });\n}\n\nconst emptyFolder = (folder) => {\n  Shell.rm('-rf', folder)\n  Shell.mkdir(folder)\n};\n\nmodule.exports = generators.Base.extend({\n  constructor: function() {\n    generators.Base.apply(this, arguments);\n  },\n\n  initializing: function () {\n    this.pkg = this.fs.readJSON(this.destinationPath('package.json'), {});\n    this.props = {\n      name: this.pkg.name || process.cwd().split(path.sep).pop(),\n      description: this.pkg.description\n    };\n\n    this.dependencies = [\n      'native-base@0.5.22',\n      'react-native-vector-icons@4.0.0',\n      'react@15.4.1',\n      'react-native-router-flux@3.37.0',\n      'react-native@0.40.0',\n      'reazy-native-router-actions@0.0.2',\n      'mobx@3.0.0',\n      'mobx-react@4.1.0'\n    ];\n\n  },\n\n  /**\n   * Check for react-native.\n   */\n  findReactNativeCli: function() {\n    var done = this.async();\n    const spinner = ora('Finding react-native').start();\n\n    checkCommmand('react-native', (isInstalled) => {\n      if(!isInstalled) {\n        spinner.fail(`Missing react-native - 'npm install -g react-native-cli'`);\n        process.exit(1);\n      }\n\n      Shell.exec('react-native --version', { silent: true }, (code, stdout, stderr) => {\n        // verify 1.x.x or higher (we need react-native link)\n        if (!stdout.match(/react-native-cli:\\s[1-9]\\d*\\.\\d+\\.\\d+/)) {\n          spinner.fail(`Must have at least version 1.x - 'npm install -g react-native-cli'`);\n          process.exit(1);\n        }\n\n        spinner.succeed('Found react-native');\n        done();\n      });\n    });\n\n  },\n\n  /**\n   * Check if Android is good\n   */\n  checkAndroid: function() {\n    var done = this.async();\n    const spinner = ora('Finding android').start();\n\n    checkCommmand('android', (isInstalled) => {\n      if (isInstalled) {\n        Shell.exec('android list', { silent: true }, (code, stdout, stderr) => {\n          if (stdout.match(/android-23/)) {\n            spinner.succeed('Found android');\n          } else {\n            spinner.fail('Missing android SDK 23');\n          }\n          done();\n        });\n      } else {\n        spinner.fail('Missing android!');\n        done();\n      }\n    });\n\n  },\n\n  /**\n   * Check for git.\n   */\n  findGit: function() {\n    const spinner = ora('Finding git').start();\n\n    checkCommmand('git', (isInstalled) => {\n      if (!isInstalled) {\n        spinner.fail(`Missing git`);\n        process.exit(1);\n      }\n\n      spinner.succeed('Found git');\n    });\n\n  },\n\n  prompting: function () {\n    var done = this.async();\n    var prompts = [\n      {\n        name: 'name',\n        message: 'Project name',\n        default: this.props.name,\n        validate: function(input) {\n          if (!input.match(/^[$A-Z_][0-9A-Z_$]*$/i)) {\n            return `${input} is not a valid name for a project.\nPlease use a valid identifier name (alphanumeric).`;\n          }\n\n          else if (input === 'React') {\n            return `${input} is not a valid name for a project.\nPlease do not use the reserved word \"React\"`;\n          } else {\n            return true;\n          }\n        }\n      },\n      {\n        name: 'description',\n        message: 'Description',\n        when: !this.pkg.description\n      },\n    ];\n\n    this.prompt(prompts).then(function (props) {\n      this.props = assign(this.props, props);\n      done();\n    }.bind(this));\n  },\n\n  writing: {\n    application: function() {\n      fs.copySync(this.templatePath('static'), this.destinationPath());\n      // fs.copySync(this.templatePath('static/.*'), this.destinationPath());\n\n      const template = fs.readFileSync(this.templatePath('react-native-index.js'), {encoding: 'utf8'});\n      const content = ejs.render(template, this.props);\n      fs.outputFileSync(this.destinationPath('src/services/react-native', 'index.js'), content, {encoding: 'utf8'});\n      // this.fs.copyTpl(\n      //   this.templatePath('react-native-index.js'),\n      //   this.destinationPath('src/services/react-native', 'index.js'),\n      //   this.props\n      // );\n\n    },\n\n    config: function() {\n      const template = fs.readFileSync(path.join(__dirname, 'templates', '_package.json'), {encoding: 'utf8'});\n      const content = ejs.render(template, this.props);\n      fs.outputFileSync(path.join(process.cwd(), 'package.json'), content, {encoding: 'utf8'});\n      // this.fs.copyTpl(\n      //   this.templatePath('package.json'),\n      //   this.destinationPath('package.json'),\n      //   this.props\n      // );\n    },\n  },\n\n  install: function() {\n    var devDependencies = [\n      'babel-jest@18.0.0',\n      'babel-plugin-transform-decorators-legacy',\n      'babel-preset-react-native@1.9.1',\n      'babel-preset-react-native-stage-0',\n      'jest@18.0.0',\n      'react-test-renderer@15.4.1'\n    ];\n\n    var self = this;\n\n    var spinnerInstallDev = ora('Installing dev dependencies').start();\n    this.npmInstall(devDependencies, { saveDev: true, stdio: 'ignore'}, function() {\n      spinnerInstallDev.succeed('Dev dependencies installed');\n\n      var spinnerInstall = ora('Installing dependencies').start();\n      self.npmInstall(self.dependencies, { save: true, stdio: 'ignore' }, function() {\n        spinnerInstall.succeed('Dependencies installed');\n        emptyFolder(self.destinationPath('android'));\n        emptyFolder(self.destinationPath('ios'));\n        Shell.rm('-f', self.destinationPath('.gitignore'));\n        Shell.rm('-f', self.destinationPath('.babelrc'));\n        Shell.rm('-f', self.destinationPath('.flowconfig'));\n        self.spawnCommandSync('react-native', ['upgrade'], {stdio: 'ignore'});\n        self.spawnCommandSync('react-native', ['link'], {stdio: 'ignore'});\n        fs.copySync(self.templatePath('_babelrc'), self.destinationPath('', '.babelrc'));\n        fs.copySync(self.templatePath('_gitignore'), self.destinationPath('', '.gitignore'));\n      });\n    });\n  },\n\n  end: function() {\n    this.log('\\nWe\\'ve created your \"' + this.props.name + '\" app!');\n\n    this.log('To start your reazy app run `react-native run-ios` or `react-native run-android`.');\n\n    process.exit(0);\n  }\n});\n"]}