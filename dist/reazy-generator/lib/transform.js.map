{"version":3,"sources":["../../../src/reazy-generator/lib/transform.js"],"names":["recast","require","traverse","inflect","parse","exports","code","convert","ast","insert","target","nodes","index","splice","apply","concat","createImport","varname","modulename","program","body","findFirstNodeAfter","type","next","result","pre","node","print","addToArrayInObject","objectCode","key","objectAst","ran","Error","parent","name","elements","length","addLastInFunction","search","addImport","camelize","underscore","expression","raw","indexOf"],"mappings":"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","file":"transform.js","sourcesContent":["var recast = require('recast');\nvar traverse = require('ast-traverse');\nvar inflect = require('i')();\n\nvar parse = exports.parse = function(code) {\n  return recast.parse(code);\n};\n\nvar convert = exports.convert = function(ast) {\n  if(typeof ast === 'string') {\n    return recast.parse(ast);\n  }\n  \n  return ast;\n};\n\nvar insert = exports.insert = function(target, nodes, index) {\n  target.splice.apply(target, [index || 0, 0].concat(nodes));\n  \n  return target;\n};\n\nvar createImport = exports.createImport = function(varname, modulename) {\n  return parse('const ' + varname + ' = require(\\'' + modulename + '\\');\\n').program.body;\n};\n\nvar findFirstNodeAfter = exports.findFirstNodeAfter = function(ast, code, type) {\n  var next = false;\n  var result = null;\n  \n  traverse(ast, {\n    pre: function(node) {\n      if(node && node.type !== 'Line' && node.type !== 'Block' && recast.print(node).code === code) {\n        next = true;\n      }\n\n      if(!result && next && (!type || node.type === type)) {\n        next = false;\n        result = node;\n      }\n    }\n  });\n  \n  return result;\n};\n\nexports.print = function(ast) {\n  return recast.print(ast).code;\n};\n\nexports.addToArrayInObject = function(ast, objectCode, key, code) {\n  ast = convert(ast);\n  \n  var objectAst = findFirstNodeAfter(ast, objectCode, 'ObjectExpression');\n  var ran = false;\n\n  if(objectAst === null) {\n    throw new Error('Could not find any object ' + objectCode);\n  }\n  \n  traverse(objectAst, {\n    pre: function(node, parent) {\n      if(node.type === 'ArrayExpression' && parent.key.name === key) {\n        insert(node.elements, parse(code).program.body, node.elements.length);\n        ran = true;\n      }\n    }\n  });\n  \n  if(!ran) {\n    throw new Error('Could not find an array for object key ' + key + ' to insert ' + code);\n  }\n  \n  return ast;\n};\n\nexports.addLastInFunction = function(ast, search, code) {\n  var node = findFirstNodeAfter(ast, search, 'FunctionExpression');\n  \n  if(node === null) {\n    throw new Error('No function expression found after ' + search);\n  }\n  \n  var nodes = node.body.body;\n  \n  insert(nodes, parse(code).program.body, nodes.length);\n  \n  return ast;\n};\n\nexports.addImport = function(ast, varname, modulename) {\n  varname = inflect.camelize(inflect.underscore(varname), false);\n  \n  ast = convert(ast);\n  \n  var index = 0;\n  var nodes = ast.program.body;\n  \n  if(nodes[0].expression && nodes[0].expression.raw.indexOf('use strict') !== -1) {\n    index = 1;\n  }\n  \n  insert(nodes, createImport(varname, modulename), index);\n  \n  return ast;\n};\n"]}